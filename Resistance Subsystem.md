Team 5 - Ride Replay Kit

Team Members: Benjamin Ebel, Jayden Marcom, Jesse Brewster, Caleb Rozenboom, Utsav Singha

# Detail Design: Resistance System
The resistance subsystem controls the linear actuator during a virtual trail. Team 5 will incorporate the previous iteration of this project's resistance system with the intent of changing the existing system into a user-interactive system. 

## Subsystem Functionality

The resistance subsystem has two main functions. First, the system must update the position on the work map generated by the work subsystem. This is done via two force sensors, one on each pedal. These two values will be averaged together and multiplied by the distance, which in this case, since the work map takes measurements every 3 meters, the distance will be 3 meters. The averaged force value will be transmitted to the Raspberry Pi via Bluetooth, where the calculations will occur. Second, the system must change the linear actuator distance to match the current work value on the trail. This actuator distance will be calculated using the formula for the force between two magnets. This way, as the work done on the work map changes every 3 meters, so the distance of the actuator will change to accomodate.

## Constraints 

|Constraint        |Description        |
|------------------|-------------------|
|Work Recreation Accuracy | The work done on the trail must stay approximately comparable to the work done on the replay bike.|
|Magnet Distance Range | The distance range between the magnets and flywheel will be kept at 2-25 mm to keep the torque reasonable. |
|Force Minimum and Maximum | The minimum force value needs to be as low as possible to provide maximum sensitivity for the user. The maximum force value is set by the force sensor at 7000 lbs. |
|Housing Security | Resistance system must not fall of the pedal during operation.


## Analysis

### Meeting Work Recreation Accuracy Constraint

The most important part of this subsystem is the distance of the actuator to recreate the work done on the trail. This is calculated by rearranging the formula for the force between the two magnets. Although the flywheel is not technically a magnet, due to the eddy currents created in the metal, it does create its own field and can be approximated as such. The change in work will be calculated by taking the first derivative of the work map. From there, the distance between the two magnets to create comparable work can be found.

The derivation starts with this formula:

$$  F(x)=\frac{3\mu}{2\pi }M^{2}V^{2}\frac{1}{x^{4}} $$
- Where F is the force between the two magnets, µ is permeability of space (4πE−7 T·m/A), M is the magnetization, V is the volume (1.287E-5 m^3), and x is the distance between the two magnets.
  
The magnetization can be described as:

$$ M=\frac{m}{V} $$
- Where m is the magnetic dipole moment.

The magnetic dipole moment can be described as:

$$ m=\frac{BrV}{\mu} $$
- Where Br is the residual flux density, V is the volume, and µ is permeability of space. The residual flux density was calculated by the last team as 14,800 Gauss.

Rearranging the force equation:

$$ x=(\frac{3\mu}{2\pi }M^{2}V^{2}\frac{1}{F(x)})^{0.25} $$

- Since work is force times displacement, we can substitute F for W/d. D is the dispacement, which in this case, is the distance traveled by the bike. 

$$ x=(\frac{3\mu}{2\pi }M^{2}V^{2}\frac{d}{W})^{0.25} $$

Shown below are the Matlab graphs showing the previous calculations:

![work map and actuator distance Matlab graphs](https://github.com/Baebel43/team5capstone/assets/143441572/0a7cb10c-7140-4ced-8418-696f7ca6e991)

- The first graph is the work map as seen from the work subsystem. The second graph is the first derivative of the work map shifted to the left so as to see where the next change in work will be wherever the work map is. The third graph is the distance of the actuator using the change in work.

Shown below is the Matlab code for the above graphs:

![actuator distance Matlab code](https://github.com/Baebel43/team5capstone/assets/143441572/b6d03d2c-0ada-449e-b01f-dc637d88485f)


### Meeting Magnet Distance Range Constraint
  
This is an inhereted constraint to stay consistent with the original design of the actuator. The range of 2-25 mm is mainly selected to not provide the user with too much or too little resistance. Team 5 will enforce this range via code in the Raspberry Pi. 

### Meeting Force Minimum and Maximum Constraint

The minimum force will be set as low as possible. According to the datasheet, the higher the feedback resistor, the more sensitive the force sensor will be (seen in Figure 1). Team 5 will calibrate the sensor to provide the most sensitive force possible. 

![SolidWorks design of work system housing](https://github.com/Baebel43/team5capstone/blob/main/Documentation/Images/ResistanceSystemImages/WorkChart.png)

Figure 1. Force Sensor Datasheet

### Meeting Housing Security Constraint
Velcro straps will be used to secure the resistance system force sensor circuit to the pedals. Two straps placed parallel to the bike should be suffiecient to keep the housing in place, also taking into account the weight of the user's foot keeping the straps in place. The option for a third strap placed perpendicular to the bike will be kept in mind, just in case two is not sufficient after testing.

## Buildable Schematics

The housings for each of the two force sensor circuits will be placed below each pedal. The force sensors will be mounted to the top of each pedal, with wires running to the housings below. The bluetooth transmitter will then send the signal to the Raspberry Pi with the work map.

![SolidWorks design of Resistance system housing](https://github.com/Baebel43/team5capstone/blob/main/Documentation/Images/ResistanceSystemImages/PedalBox.png)

Figure 2. Corner View of Housing for Resistance System

![Work system housing with lid](https://github.com/Baebel43/team5capstone/blob/main/Documentation/Images/ResistanceSystemImages/PedalLid.png)

Figure 3. Design of Housing for Work System with Lid

![Housing on Bike 1](https://github.com/Baebel43/team5capstone/blob/main/Documentation/Images/ResistanceSystemImages/ResistanceSystemOnBikeSideView.png)

Figure 4. Housing on Bike Side View

![Housing on Bike 2](https://github.com/Baebel43/team5capstone/blob/main/Documentation/Images/ResistanceSystemImages/ResistanceSystemOnBikeTopView.png)

Figure 5. Housing on Bike Top View

![Housing on Bike Corner View](https://github.com/Baebel43/team5capstone/blob/main/Documentation/Images/ResistanceSystemImages/ResistanceSystemOnBikeCornerView.png)

Figure 6. Housing on Bike Corner View

![Holder for magnet back](https://github.com/Baebel43/team5capstone/blob/main/Documentation/Images/ResistanceSystemImages/ResistanceSystemCircuitDesign.png)

Figure 7. Force Sensor Circuit Design



## Bill of Materials

|Item|Description|Part Number|Manufacturer|Quantity|Individual Price|Total|
|----|-----------|-----------|------------|--------|----------------|-----|
|Force Sensor|Force Sensing Resistor Force Sensor 3175.15kgf (7000 lbs)|A401-25|Tekscan|3|$26.30|$78.90|
|Opamp|General Purpose Amplifier 4 Circuit Rail-to-Rail 14-PDIP|MCP6004-I/P|Microchip Technology|2|$0.59|$1.08|
|100 kΩ potentiometer|100 kOhms 0.5W, 1/2W PC Pins Through Hole Trimmer Potentiometer Cermet 1.0 Turn Top Adjustment|3386P-1-104LF|Bourns Inc.|1|$1.61|$1.61|
|Battery Holder|Battery Holder (Open) AA 3 Cell Wire Leads - 6" (152.4mm)|BC3AAW|MPD|1|$2.33|$2.33|
|47 pF capacitor|47 pF Mica Capacitor 500 V Radial|CD15ED470JO3|Cornell Dubilier Electronics (CDE)|1|$1.73|$1.73|
|Perfboard|Breadboard, General Purpose Plated Through Hole (PTH) Pad Per Hole (Round) 0.1" (2.54mm) Grid|ST-PERF-1-2|SchmalzTech, LLC|1|$1.95|$1.95|
|Arduino Nano 33 BLE|Arduino Nano 33 Bluetooth Low Energy Microcontroller|ABX00030 |Arduino|1|$26.30|$26.30|
|Total|||Total Components|10|Total Cost|$119.00|

## References:
[1]”Spring2023-Mario-Kart-BikeV2 Resistance System,”
﻿​﻿​﻿​​​﻿﻿[Spring2023-Mario-Kart-BikeV2/Documentation/Signoffs/ResistanceSystem.md at main · TnTech-ECE/Spring2023-Mario-Kart-BikeV2 (github.com)](https://github.com/TnTech-ECE/Spring2023-Mario-Kart-BikeV2/blob/main/Documentation/Signoffs/ResistanceSystem.md)https://github.com/TnTech-ECE/Spring2023-Mario-Kart-BikeV2/blob/main/Documentation/Signoffs/ResistanceSystem.md

[2]"Force between two cylindrical magnets,"https://en.wikipedia.org/wiki/Force_between_magnets#:~:text=The%20most%20elementary%20force%20between%20magnets%20is%20the,magnet%20and%20the%20dipoles%20of%20the%20second%20magnet.


